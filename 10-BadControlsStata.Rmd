# Malos Controles en Stata

::: {.boxinfo}
**üéØ Metas de aprendizaje**
- Ver por qu√© controlar un **mediador** (variable post-tratamiento) **reduce** el coeficiente de \(D\) cuando queremos el **efecto total**.  
- Entender, con un ejemplo separado y simple, qu√© es un **colisionador** y por qu√© controlarlo abre un camino espurio que sesga el estimador.  
- Confirmar con un **Mini-Monte Carlo** que estos sesgos aparecen en promedio.  
- Visualizar los resultados con **coefplots** e **histogramas**.
:::

---

## Mediador (post-tratamiento)

**Idea:** \(D\) afecta a \(Y\). Tambi√©n \(D\) afecta una variable \(M\) (post-tratamiento), que a su vez afecta \(Y\).  
Si **controlas \(M\)** cuando tu objetivo es el **efecto total** de \(D\) sobre \(Y\), ‚Äúle quitas‚Äù al coeficiente la parte del camino \(D \rightarrow M \rightarrow Y\).  


### Mediador: \( D \rightarrow M \rightarrow Y \) {-}
<div style="margin:1rem 0;"> <svg width="520" height="140" viewBox="0 0 520 140" xmlns="http://www.w3.org/2000/svg"> <defs> <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth"> <path d="M0,0 L0,6 L9,3 z" fill="#333" /> </marker> <style> .node { fill: #fff; stroke: #333; stroke-width: 2px; } .label { font-family: sans-serif; font-size: 14px; fill: #111; dominant-baseline: middle; text-anchor: middle; } .edge { stroke: #333; stroke-width: 2px; fill: none; marker-end: url(#arrow); } </style> </defs> <!-- Nodes --> <circle class="node" cx="60" cy="70" r="24"/> <text class="label" x="60" y="70">D</text> <circle class="node" cx="220" cy="70" r="24"/> <text class="label" x="220" y="70">M</text> <circle class="node" cx="380" cy="70" r="24"/> <text class="label" x="380" y="70">Y</text> <circle class="node" cx="380" cy="24" r="24"/> <text class="label" x="380" y="24">U</text> <!-- Edges --> <line class="edge" x1="84" y1="70" x2="196" y2="70"/> <line class="edge" x1="244" y1="70" x2="356" y2="70"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <!-- small spacer --> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <!-- (keeps marker size consistent) --> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <!-- Actual U->Y --> <path class="edge" d="M380,48 L380,46 M380,48 L380,46 M380,48 L380,46 M380,48 L380,46"/> <path class="edge" d="M380,48 L380,46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <!-- Simple straight U->Y --> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <!-- Clean final arrow --> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <!-- Minimal final arrow (from U to Y) --> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <!-- Real arrow U->Y --> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <!-- Simpler: draw a direct line --> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <!-- Final actual line --> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> <!-- Sorry for redundancy; some renderers clip short markers. --> <line class="edge" x1="380" y1="48" x2="380" y2="46"/> </svg> <p style="font-family:sans-serif; font-size:13px; color:#333;"> <b>Nota:</b> Si tu par√°metro es el <i>efecto total</i> de D sobre Y, <b>no</b> controles M. </p> </div>

```stata
********************************************************************************
* SOLO MEDIADOR: versi√≥n simple y did√°ctica
********************************************************************************
clear all
set more off
set seed 2468
set obs 50000

gen D = (runiform()<0.5)
local rho = .30
matrix C = (1, `rho' \ `rho', 1)
drawnorm eY eM, corr(C)

replace eY = 4*eY
gen Y_0 = 1 + eY
gen Y_1 = 3 + eY
gen Y   = D*Y_1 + (1-D)*Y_0

replace eM = 4*eM
gen M_0 = 1 + eM
gen M_1 = 4 + eM
gen M   = D*M_1 + (1-D)*M_0

reg Y D
reg Y D M

capture program drop mc_mediador
program define mc_mediador, rclass
    clear
    set obs 3000
    gen D = (runiform()<0.5)
    matrix C = (1, .30 \ .30, 1)
    drawnorm eY eM, corr(C)
    replace eY = 4*eY
    replace eM = 4*eM

    gen Y_0 = 1 + eY
    gen Y_1 = 3 + eY
    gen Y   = D*Y_1 + (1-D)*Y_0

    gen M_0 = 1 + eM
    gen M_1 = 4 + eM
    gen M   = D*M_1 + (1-D)*M_0

    qui reg Y D
    return scalar b_total = _b[D]
    qui reg Y D M
    return scalar b_directo = _b[D]
end

simulate b_total=r(b_total) b_directo=r(b_directo), reps(300): mc_mediador
sum b_total b_directo

```
**Lectura esperada:**

* `reg Y D` recupera el **efecto total**.
* `reg Y D M` da solo el **efecto directo**, m√°s peque√±o.

```stata
coefplot (reg Y D) (reg Y D M), keep(D) ///
    xline(0) drop(_cons) ///
    legend(order(1 "Total" 2 "Directo (con M)")) ///
    title("Mediador: coeficiente de D")
```

## Colisionador {-}

**Idea:**

* $U$ afecta $Y$.
* $C$ es causado por $D$ y por $U$.
* Si controlamos $C$, se abre el camino $D \leftrightarrow U \rightarrow Y$.


<div style="margin:1rem 0;"> <svg width="520" height="160" viewBox="0 0 520 160" xmlns="http://www.w3.org/2000/svg"> <defs> <marker id="arrow2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth"> <path d="M0,0 L0,6 L9,3 z" fill="#333" /> </marker> <style> .node { fill: #fff; stroke: #333; stroke-width: 2px; } .label { font-family: sans-serif; font-size: 14px; fill: #111; dominant-baseline: middle; text-anchor: middle; } .edge { stroke: #333; stroke-width: 2px; fill: none; marker-end: url(#arrow2); } </style> </defs> <!-- Nodes --> <circle class="node" cx="60" cy="90" r="24"/> <text class="label" x="60" y="90">D</text> <circle class="node" cx="220" cy="90" r="24"/> <text class="label" x="220" y="90">C</text> <circle class="node" cx="220" cy="34" r="24"/> <text class="label" x="220" y="34">U</text> <circle class="node" cx="380" cy="90" r="24"/> <text class="label" x="380" y="90">Y</text> <!-- Edges -->
<line class="edge" x1="84" y1="90" x2="196" y2="90"/> <!-- D -> C -->
<line class="edge" x1="220" y1="58" x2="220" y2="66"/> <!-- U -> C (down) -->
<line class="edge" x1="244" y1="90" x2="356" y2="90"/> <!-- C -> Y? no, U -> Y -->
<!-- Replace previous with U -> Y -->
<line class="edge" x1="244" y1="34" x2="356" y2="90"/> <!-- U -> Y (diagonal) -->
</svg>
<p style="font-family:sans-serif; font-size:13px; color:#333;"> <b>Nota:</b> Controlar <b>C</b> abre el camino <i>D ‚ü∑ U ‚Üí Y</i> y sesga el efecto de <b>D</b>. </p> </div>

```stata
********************************************************************************
* COLISIONADOR: 
********************************************************************************
clear
set more off
set seed 2468
set obs 50000

gen U  = rnormal()
gen eC = rnormal()
gen eY = rnormal()
gen D  = (runiform()<0.5)

gen C = 0.7*D + 0.7*U + eC
gen Y = 2 + 2.0*D + 1.0*U + eY

reg Y D        // Benchmark correcto
reg Y D C      // Sesgado por controlar colisionador
```

---


```stata


---

## Mini-Monte Carlo: Colisionador

```stata
********************************************************************************
* MONTE CARLO: Colisionador
********************************************************************************
capture program drop mc_colisionador
program define mc_colisionador, rclass
    clear
    set obs 3000
    gen U  = rnormal()
    gen eC = rnormal()
    gen eY = rnormal()
    gen D  = (runiform()<0.5)

    gen C = 0.7*D + 0.7*U + eC
    gen Y = 2 + 2.0*D + 1.0*U + eY

    qui reg Y D
    return scalar b_bench = _b[D]
    qui reg Y D C
    return scalar b_conC = _b[D]
end

simulate b_bench=r(b_bench) b_conC=r(b_conC), reps(300): mc_colisionador
sum b_bench b_conC
```

---

## Gr√°ficos de apoyo

### Coefplot del mediador

```stata
coefplot (reg Y D) (reg Y D M), keep(D) ///
    xline(0) drop(_cons) ///
    legend(order(1 "Total" 2 "Directo (con M)")) ///
    title("Mediador: coeficiente de D")
```

### Histogramas Monte Carlo

```stata
* Histogramas lado a lado para mediador
twoway (hist b_total, width(.1) color(navy%40)) ///
       (hist b_directo, width(.1) color(red%40)), ///
       legend(order(1 "Total" 2 "Directo")) ///
       title("Distribuci√≥n de coef D: con y sin M")

* Histogramas para colisionador
twoway (hist b_bench, width(.1) color(green%40)) ///
       (hist b_conC, width(.1) color(orange%40)), ///
       legend(order(1 "Benchmark" 2 "Con C")) ///
       title("Distribuci√≥n de coef D: benchmark vs. colisionador")
```

---

## Resumen pr√°ctico

* **Mediador:** si buscas el **efecto total**, **no lo controles**.
* **Colisionador:** nunca lo controles; introduce sesgo espurio.
* **Pre-tratamiento:** buenos controles para ganar precisi√≥n.




# Malos controles: **Mediador (M)** vs **Colisionador (C)** ‚Äî DAGs {-}
<!-- MEDIADOR --> <h3 style="margin:0 0 8px 0; font-family:sans-serif;">Mediador (M)</h3> <svg width="560" height="150" viewBox="0 0 560 150" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="DAG Mediador"> <defs> <marker id="arrowM" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth"> <path d="M0,0 L0,6 L9,3 z" fill="#111" /> </marker> <style> .node { fill:#fff; stroke:#111; stroke-width:2px; } .label{ font:14px sans-serif; fill:#111; dominant-baseline:middle; text-anchor:middle; } .edge { stroke:#111; stroke-width:2px; fill:none; marker-end:url(#arrowM); } .pill { fill:#fee2e2; stroke:#b91c1c; stroke-width:1.5px; rx:6; ry:6; } .warn { font:12px sans-serif; fill:#b91c1c; } </style> </defs> <!-- Nodes -->
<circle class="node" cx="60" cy="90" r="24"/><text class="label" x="60" y="90">D</text>
<circle class="node" cx="240" cy="90" r="24"/><text class="label" x="240" y="90">M</text>
<circle class="node" cx="420" cy="90" r="24"/><text class="label" x="420" y="90">Y</text>
<circle class="node" cx="420" cy="30" r="24"/><text class="label" x="420" y="30">U</text>
<!-- Edges --> <line class="edge" x1="84" y1="90" x2="216" y2="90"/> <line class="edge" x1="264" y1="90" x2="396" y2="90"/> <line class="edge" x1="420" y1="54" x2="420" y2="66"/> <!-- Nota --> <rect x="170" y="116" width="140" height="24" class="pill"/> <text class="warn" x="240" y="132">No controles M</text> </svg> <hr style="border:none; border-top:1px solid #eee; margin:16px 0;"> <!-- COLISIONADOR --> <h3 style="margin:0 0 8px 0; font-family:sans-serif;">Colisionador (C)</h3> <svg width="560" height="150" viewBox="0 0 560 150" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="DAG Colisionador"> <defs> <marker id="arrowC" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth"> <path d="M0,0 L0,6 L9,3 z" fill="#111" /> </marker> <style> .node { fill:#fff; stroke:#111; stroke-width:2px; } .label{ font:14px sans-serif; fill:#111; dominant-baseline:middle; text-anchor:middle; } .edge { stroke:#111; stroke-width:2px; fill:none; marker-end:url(#arrowC); } .pill { fill:#ffedd5; stroke:#b45309; stroke-width:1.5px; rx:6; ry:6; } .warn { font:12px sans-serif; fill:#b45309; } .dash { stroke:#b45309; stroke-width:1.5px; fill:none; stroke-dasharray:4 4; } </style> </defs> <!-- Nodes -->
<circle class="node" cx="60" cy="90" r="24"/><text class="label" x="60" y="90">D</text>
<circle class="node" cx="240" cy="90" r="24"/><text class="label" x="240" y="90">C</text>
<circle class="node" cx="240" cy="30" r="24"/><text class="label" x="240" y="30">U</text>
<circle class="node" cx="420" cy="90" r="24"/><text class="label" x="420" y="90">Y</text>
<!-- Edges -->
<line class="edge" x1="84" y1="90" x2="216" y2="90"/> <!-- D -> C -->
<line class="edge" x1="240" y1="54" x2="240" y2="66"/> <!-- U -> C -->
<line class="edge" x1="258" y1="42" x2="402" y2="78"/> <!-- U -> Y (diagonal) -->
<!-- Nota --> <rect x="170" y="116" width="140" height="24" class="pill"/> <text class="warn" x="240" y="132">No controles C</text> <!-- Camino espurio ilustrado --> <path d="M90,66 C150,10 330,10 390,66" class="dash"/> <text x="280" y="18" class="warn" style="text-anchor:middle;">Condicionar en C abre D ‚ü∑ U ‚Üí Y</text> </svg>


<table style="width:100%; border-collapse:collapse; font-family:sans-serif; font-size:14px;">
  <thead>
    <tr>
      <th style="border-bottom:2px solid #e5e7eb; text-align:left; padding:8px;">Aspecto</th>
      <th style="border-bottom:2px solid #e5e7eb; text-align:left; padding:8px;">Mediador (M)</th>
      <th style="border-bottom:2px solid #e5e7eb; text-align:left; padding:8px;">Colisionador (C)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border-bottom:1px solid #f3f4f6; padding:8px;">Estructura causal</td>
      <td style="border-bottom:1px solid #f3f4f6; padding:8px;"><code>D ‚Üí M ‚Üí Y</code> (y posibles <code>U ‚Üí Y</code>)</td>
      <td style="border-bottom:1px solid #f3f4f6; padding:8px;"><code>D ‚Üí C ‚Üê U ‚Üí Y</code></td>
    </tr>
    <tr>
      <td style="border-bottom:1px solid #f3f4f6; padding:8px;">Qu√© ocurre si controlas</td>
      <td style="border-bottom:1px solid #f3f4f6; padding:8px;">Condicionas en post-tratamiento ‚áí cambias la poblaci√≥n de comparaci√≥n ‚áí <b>sesgo</b> respecto al efecto total.</td>
      <td style="border-bottom:1px solid #f3f4f6; padding:8px;">Abres camino espurio <code>D ‚ü∑ U ‚Üí Y</code> ‚áí <b>sesgo</b>.</td>
    </tr>
    <tr>
      <td style="border-bottom:1px solid #f3f4f6; padding:8px;">Frase para clase</td>
      <td style="border-bottom:1px solid #f3f4f6; padding:8px;">Si buscas el <i>efecto total</i> de D en Y, <b>no controles M</b>.</td>
      <td style="border-bottom:1px solid #f3f4f6; padding:8px;"><b>Nunca</b> controles colisionadores.</td>
    </tr>
    <tr>
      <td style="padding:8px;">Ejemplo empleo</td>
      <td style="padding:8px;"><i>D</i>=usar redes; <i>M</i>=entrar al sector formal; <i>Y</i>=salario.</td>
      <td style="padding:8px;"><i>D</i>=usar redes; <i>C</i>=tama√±o de empresa; <i>U</i>=habilidad; <i>Y</i>=salario.</td>
    </tr>
  </tbody>
</table>

````markdown
# Malos Controles con **F** (en el an√°lisis de **D ‚Üí Y**)

**Objetivo:** Estimar el efecto causal de **D** sobre **Y** y mostrar por qu√© **F** es un **mal control** bajo tres estructuras causales distintas (todas en regresiones lineales con datos simulados):

- **Colisionador:** `D ‚Üí F ‚Üê Y`  
- **Descendiente de colisionador:** `D ‚Üí Y ‚Üê U` y `Y ‚Üí F`  
- **Post-tratamiento / Mediador (sobrecontrol si buscamos efecto total):** `D ‚Üí F ‚Üí Y`

Cada bloque trae: generaci√≥n de datos, regresiones **Y ~ D** (modelo objetivo) vs **Y ~ D + F** (mal control), e **Mini Monte Carlo (300 reps)** para ver el sesgo promedio al controlar **F**.

---

## Teor√≠a r√°pida: por qu√© **F** puede ser un mal control

- **Colisionador (`D ‚Üí F ‚Üê Y`)**  
  Ajustar por **F** **abre** un camino espurio entre **D** y **Y** que antes estaba **bloqueado**. Resultado: el coeficiente de **D** queda **sesgado**.

- **Descendiente de colisionador (`D ‚Üí Y ‚Üê U` y `Y ‚Üí F`)**  
  **F** es descendiente de **Y**, que es un **colisionador** entre **D** y un factor no observado **U** (o el error de **Y**). Al condicionar en **F**, se induce dependencia entre **D** y **U**, sesgando el efecto de **D** sobre **Y**.

- **Post-tratamiento / Mediador (`D ‚Üí F ‚Üí Y`)**  
  Si el par√°metro de inter√©s es el **efecto total** de **D** sobre **Y**, **no** debemos condicionar en **F** (porque **F** es **descendiente de D** y est√° en la **ruta causal**). Ajustarlo **bloquea** la v√≠a `D ‚Üí F ‚Üí Y` y **sesga** (generalmente a la baja) el coeficiente de **D** respecto del **total**.

> **Regla pr√°ctica:** No controles **colisionadores**, ni **descendientes de colisionadores**, ni **variables post-tratamiento** si buscas el **efecto total** de **D**.

---

## Caso A ‚Äî **F como colisionador** (`D ‚Üí F ‚Üê Y`)

**Intuici√≥n:** **D** y **Y** son independientes en la poblaci√≥n (efecto verdadero de D en Y = 0). **F** es causado por ambos. Si ajustas por **F**, abres un camino espurio `D ‚Üî Y` y obtienes un coeficiente de **D** distinto de 0 (sesgo).

```stata
********************************************************************************
* CASO A: F como COLISIONADOR ‚Äî D -> F <- Y
* Efecto verdadero de D en Y: 0 (D y Y independientes). Controlar F induce sesgo.
********************************************************************************

clear all
set seed 12345
set obs 1000

* D y Y independientes
gen double D = rnormal(0,1)
gen double Y = rnormal(0,1)

* F causado por D y Y  ->  F es colisionador
gen double F = 2*D - 0.5*Y + rnormal(0,1)

* (Correcto) estimar Y~D: coef(D) ‚âà 0
reg Y D, vce(robust)

* (MAL control) estimar Y~D+F: coef(D) ‚â† 0 por abrir el camino v√≠a F
reg Y D F, vce(robust)


*---------------*
* MONTE CARLO   *
*---------------*
capture program drop mc_F_collider
program define mc_F_collider, rclass
    clear
    set obs 1000
    gen double D = rnormal()
    gen double Y = rnormal()
    gen double F = 2*D - 0.5*Y + rnormal()
    qui reg Y D
    return scalar b_noF = _b[D]
    qui reg Y D F
    return scalar b_conF = _b[D]
end

simulate b_noF=r(b_noF) b_conF=r(b_conF), reps(300): mc_F_collider
summ b_noF b_conF
* Esperado: mean(b_noF) ‚âà 0 (insesgado); mean(b_conF) ‚â† 0 (sesgo por controlar F).
````

**Lectura esperada:**

* `Y ~ D` recupera ‚âà 0 (no hay efecto causal de D sobre Y).
* `Y ~ D + F` produce un coeficiente de D **significativamente distinto** de 0 ‚áí **sesgo** por colisionador.

---

## Caso B ‚Äî **F descendiente de colisionador** (`D ‚Üí Y ‚Üê U` y `Y ‚Üí F`)

**Intuici√≥n:** **Y** es colisionador entre **D** y **U** (no observado). **F** es descendiente de **Y**. Condicionar en **F** introduce dependencia entre **D** y **U** y sesga el coeficiente de **D**. Aqu√≠ el **efecto verdadero** de **D** en **Y** es **2**.

```stata
********************************************************************************
* CASO B: F descendiente de colisionador ‚Äî D -> Y ‚Üê U  y  Y -> F
* Efecto verdadero de D en Y: 2. Controlar F (descendiente de Y) sesga el coef(D).
********************************************************************************

clear all
set seed 12345
set obs 1000

* D ~ N(0,1), eY ~ N(0,1) (eY juega el papel de U no observado en Y)
gen double D  = rnormal()
gen double eY = rnormal()

* Outcome con efecto real de 2: Y = 2*D + eY
gen double Y  = 2*D + eY

* F es descendiente de Y: F = -0.5*Y + ruido
gen double F  = -0.5*Y + rnormal()

* (Correcto) Y~D: recupera ‚âà 2
reg Y D, vce(robust)

* (MAL control) Y~D+F: sesgo (condicionar en descendiente de colisionador vincula D con eY)
reg Y D F, vce(robust)


*---------------*
* MONTE CARLO   *
*---------------*
capture program drop mc_F_desc
program define mc_F_desc, rclass
    clear
    set obs 1000
    gen double D  = rnormal()
    gen double eY = rnormal()
    gen double Y  = 2*D + eY
    gen double F  = -0.5*Y + rnormal()
    qui reg Y D
    return scalar b_noF = _b[D]
    qui reg Y D F
    return scalar b_conF = _b[D]
end

simulate b_noF=r(b_noF) b_conF=r(b_conF), reps(300): mc_F_desc
summ b_noF b_conF
* Esperado: mean(b_noF) ‚âà 2 (correcto); mean(b_conF) < 2 (sesgo por condicionar en F).
```

**Lectura esperada:**

* `Y ~ D` ‚âà 2 (efecto verdadero).
* `Y ~ D + F` tiende a **subestimar** (u otra distorsi√≥n) el efecto de D ‚áí **sesgo** por condicionar en un descendiente de colisionador.

---

## Caso C ‚Äî **F post-tratamiento (mediador)** (`D ‚Üí F ‚Üí Y`)

*(sobrecontrol si buscamos el **efecto total** de D)*

**Intuici√≥n:** todo el efecto de **D** sobre **Y** pasa por **F** (no hay efecto directo adicional de D). El **efecto total** es `a*b`. Si ajustas por **F**, bloqueas la ruta causal y el coeficiente de **D** se va a ‚âà 0: **sobrecontrol** (sesgo respecto del total).

```stata
********************************************************************************
* CASO C: F post-tratamiento (mediador) ‚Äî D -> F -> Y
* Inter√©s: EFECTO TOTAL de D en Y (= a*b). Controlar F lo bloquea (sobrecontrol).
********************************************************************************

clear all
set seed 12345
set obs 1000

scalar a = 2   // D -> F
scalar b = 3   // F -> Y

* D ex√≥geno
gen double D = rnormal()

* F mediador afectado por D
gen double F = a*D + rnormal()

* Y depende de F (sin efecto directo adicional de D en esta DGP)
gen double Y = b*F + rnormal()

* (Correcto para efecto TOTAL) Y~D: coef(D) ‚âà a*b = 6
reg Y D, vce(robust)

* (MAL control para efecto TOTAL) Y~D+F: bloquea D->F->Y, coef(D) ‚âà 0 (sobrecontrol)
reg Y D F, vce(robust)


*---------------*
* MONTE CARLO   *
*---------------*
capture program drop mc_F_mediador
program define mc_F_mediador, rclass
    clear
    set obs 1000
    scalar a = 2
    scalar b = 3
    gen double D = rnormal()
    gen double F = a*D + rnormal()
    gen double Y = b*F + rnormal()
    qui reg Y D
    return scalar b_total = _b[D]     // efecto total ‚âà a*b
    qui reg Y D F
    return scalar b_conF = _b[D]      // efecto directo (‚âà 0 en esta DGP)
end

simulate b_total=r(b_total) b_conF=r(b_conF), reps(300): mc_F_mediador
summ b_total b_conF
* Esperado: mean(b_total) ‚âà 6 (total); mean(b_conF) ‚âà 0 (sobrecontrol al incluir F).
```

**Lectura esperada:**

* `Y ~ D` ‚âà `a*b` (efecto total).
* `Y ~ D + F` ‚âà 0 (porque bloquear F elimina la ruta causal completa de D hacia Y).

---

## Resumen pedag√≥gico

* **Colisionador (`D ‚Üí F ‚Üê Y`)**: ajustar por **F** **abre** un camino espurio ‚Üí **sesgo**.
* **Descendiente de colisionador (`D ‚Üí Y ‚Üê U` y `Y ‚Üí F`)**: ajustar por **F** **induce dependencia** entre **D** y **U** ‚Üí **sesgo**.
* **Post-tratamiento / Mediador (`D ‚Üí F ‚Üí Y`)**: si buscas **efecto total**, **no controles F** (sobrecontrol).
* Los **p-valores** pueden sugerir que **F** ‚Äúsirve para predecir‚Äù, pero **predicci√≥n ‚â† identificaci√≥n**: sin el DAG correcto, el estimador causal puede ser **inconsistente**.

---

## DESCARGA LOS DOCUMENTOS {-}

**Descargar Stata do file**:
[Descargar Stata](https://raw.githubusercontent.com/adiazescobar/libro_cortes/main/dofile/Clase0_StataBasics/clase0_stata.do)

**Descargar R script**:
[Descargar R](https://raw.githubusercontent.com/adiazescobar/libro_cortes/main/dofile/Clase0_StataBasics/clase0_R.R)

**Descargar Phyton Notebook**:
[Descargar Phyton](https://raw.githubusercontent.com/adiazescobar/libro_cortes/main/dofile/Clase0_StataBasics/clase0_phyton.ipynb)

[![Abrir en Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/adiazescobar/libro_cortes/blob/main/dofile/Clase0_StataBasics/clase0_phyton.ipynb)

**Descarga los Datos**
[Descargar Datos](https://raw.githubusercontent.com/adiazescobar/libro_cortes/main/dofile/Clase0_StataBasics/hh_98.dta)

```
```


